<br>

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0" y="0" width="325" height="400" viewBox="0, 0, 325, 400">
  <defs>
    <linearGradient id="Gradient_1" gradientUnits="userSpaceOnUse" x1="163" y1="5.5" x2="163" y2="395.5">
      <stop offset="0" stop-color="#FFFFFF" stop-opacity="0"/>
      <stop id="moving-line" offset="<%= 1 - @presenter.drinks_today_percentage_to_goal %>" stop-color="#97CAE2" stop-opacity="0.428"/>
      <stop offset="1" stop-color="#0D84BB"/>
    </linearGradient>
  </defs>
  <g id="Layer_1">
    <g>
      <path id="filler" d="M13,5.5 L54,395.5 L272,395.5 L313,5.5 L13,5.5" fill="url(#Gradient_1)"/>
      <path id="glass-path" d="M13,5.5 L54,395.5 L272,395.5 L313,5.5 L13,5.5" fill-opacity="0" stroke="#0A7D92" stroke-width="6"/>
    </g>
  </g>
</svg>
<div id='drink-info'>
  <h2 id='count' style="margin-left: 75px"><%= @presenter.drinks_today_count %></h2>
  <h3 id='percentage' style="margin-left: 75px"><%= number_to_percentage(@presenter.drinks_today_percentage_to_goal * 100, precision: 0) %></h3>
  <h3 id='time' style="margin-left: 75px"><%= @presenter.most_recent_drink_time %></h3>
</div>

<script>

  $(document).ready(function() {
    // $('#Layer_1 g:first-child').first().children().first().attr('fill', 'white');
  });

  $('#Layer_1').on('click', function() {
    fillGlass();
  });

  var oneSixth = 0.166
  var offset          = 1 - <%= @presenter.drinks_today_percentage_to_goal %>
  var glassCount      = <%= @presenter.drinks_today_count %>
  var glassPercentage = <%= @presenter.drinks_today_percentage_to_goal %>

  function fillGlass() {
    offset          -= oneSixth;
    glassPercentage += oneSixth
    glassCount      += 1;
    var timeString  = grabTimeString();

    updateDrinkElements(offset, glassCount, glassPercentage, timeString);
  };

  function grabTimeString() {
    var time       = new Date().toString();
    var datePieces = time.split(' ');
    var timePieces = datePieces[4].split(':');
    var hour       = parseInt(timePieces[0]) <= 12 ? timePieces[0] : parseInt(timePieces[0]) - 12;
    var suffix     = parseInt(timePieces[0]) <= 12 ? ' AM' : ' PM';
    var timeString = datePieces[1] + ' ' + datePieces[2] + ', ' + hour + ":" + timePieces[1] + suffix;

    return timeString;
  };

  function updateDrinkElements(offset, glassCount, glassPercentage, timeString) {
    $('#moving-line').attr('offset', offset);
    $('#count').text(glassCount);
    $('#percentage').text(Math.round(glassPercentage * 100) + "%");
    $('#time').text(timeString);
  };
</script>
